<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Attendance Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family:'Inter',sans-serif; margin:0; padding:0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#1a202c; }
  .container { max-width:1200px; margin:0 auto; padding:1rem; min-height:100vh; }
  .header, .attendance-section, .sidebar { border-radius:16px; background:white; padding:2rem; box-shadow:0 8px 32px rgba(0,0,0,0.1); }
  .header h1 { font-size:2.5rem; color:#667eea; }
  .header-info { display:flex; justify-content:center; gap:2rem; flex-wrap:wrap; margin-top:1rem; }
  .info-item { display:flex; align-items:center; gap:0.5rem; color:#4a5568; font-weight:500; }
  .edit-icon { background:transparent; border:none; cursor:pointer; font-size:0.95rem; }
  .main-content { display:grid; grid-template-columns:1fr 300px; gap:1.5rem; margin-top:2rem; }
  .student-list .student-card { margin-bottom:1rem; border-radius:12px; padding:1rem; background:#f7fafc; border:2px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center; }
  .student-card.present { border-color:#48bb78; background:#f0fff4; }
  .student-card.absent { border-color:#f56565; background:#fff5f5; }
  .student-card.late { border-color:#ed8936; background:#fffaf0; }
  .status-badge { padding:0.25rem 0.75rem; border-radius:20px; font-size:0.875rem; font-weight:600; text-transform:uppercase; }
  .status-badge.present { background:#c6f6d5; color:#22543d; }
  .status-badge.absent { background:#fed7d7; color:#742a2a; }
  .status-badge.late { background:#feebc8; color:#7b341e; }
  .stats-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:1rem; margin-top:1rem; }
  .stat-card { border-radius:12px; padding:1rem; background:#f7fafc; text-align:center; font-weight:600; }
  .stat-card.present { background:#c6f6d5; color:#22543d; }
  .stat-card.absent { background:#fed7d7; color:#742a2a; }
  .stat-card.late { background:#feebc8; color:#7b341e; }
  .form-input { padding:0.5rem 1rem; border-radius:8px; border:1px solid #cbd5e0; width:70%; }
  .btn { padding:0.5rem 1rem; border-radius:8px; cursor:pointer; font-weight:600; border:none; }
  .btn-primary { background:#667eea; color:white; }
  .btn-warning { background:#f59e0b; color:white; }
  .modal-backdrop { position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.4); display:flex; justify-content:center; align-items:center; z-index:1000; }
  .modal { background:white; border-radius:12px; padding:2rem; max-width:400px; width:90%; box-shadow:0 10px 40px rgba(0,0,0,0.2); }
  .toast { position: fixed; bottom: 2rem; left:50%; transform: translateX(-50%); background:#4ade80; color:white; padding:0.75rem 1.5rem; border-radius:12px; font-weight:600; box-shadow:0 4px 12px rgba(0,0,0,0.15); z-index:1001; }
  .date-picker { margin-top:1rem; display:flex; justify-content:center; gap:1rem; }
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <h1 id="app-title">Attendance Tracker</h1>
    <div class="header-info">
      <div class="info-item">
        <span>üìö</span>
        <span id="class-name">Math 101</span>
        <button class="edit-icon" onclick="openTeacherModal()">‚úèÔ∏è</button>
      </div>
      <div class="info-item"><span>üë®‚Äçüè´</span><span id="teacher-name">Mr. Johnson</span></div>
      <div class="info-item"><span>üìß</span><span id="teacher-email">johnson@example.com</span></div>
      <div class="info-item"><span>üì±</span><span id="teacher-phone">+1234567890</span></div>
      <div class="info-item"><span>üìÖ</span><span id="current-date"></span></div>
    </div>
    <div class="date-picker">
      <label class="text-gray-700 font-semibold">Select Date:</label>
      <input type="date" id="attendance-date" class="form-input"/>
    </div>
  </header>

  <main class="main-content">
    <section class="attendance-section">
      <h2 class="section-title">Student Attendance</h2>
      <form id="add-student-form" class="add-student-form">
        <input type="text" id="student-name-input" class="form-input" placeholder="Enter student name" required />
        <button type="submit" class="btn btn-primary">‚ûï Add Student</button>
      </form>
      <div id="student-list" class="student-list">
        <div class="empty-state"><h3>No students added yet</h3><p>Add students using the form above</p></div>
      </div>
    </section>

    <aside class="sidebar">
      <h3 class="section-title">Summary</h3>
      <div class="stats-grid">
        <div class="stat-card present"><div id="present-count">0</div><div>Present</div></div>
        <div class="stat-card absent"><div id="absent-count">0</div><div>Absent</div></div>
        <div class="stat-card late"><div id="late-count">0</div><div>Late</div></div>
        <div class="stat-card"><div id="total-count">0</div><div>Total</div></div>
      </div>
      <button class="btn btn-primary w-full mt-4" onclick="exportAttendance()">üìä Export Report</button>
      <button class="btn btn-warning w-full mt-2" onclick="clearTodayAttendance()">üîÑ Reset</button>
      <button class="btn btn-primary w-full mt-2" onclick="openDuplicateModal()">üìã Duplicate Attendance</button>
    </aside>
  </main>
</div>

<script>
const STORAGE_KEY='attendance_data_v5';
const META_KEY='attendance_meta_v5';
const defaultMeta={class_name:'Math 101', teacher_name:'Mr. Johnson', teacher_email:'johnson@example.com', teacher_phone:'+1234567890'};

let meta=loadMeta();
let currentDate = new Date().toISOString().slice(0,10);
let currentData = loadDataForDate(currentDate);

function persistDataForDate(date,data){localStorage.setItem(STORAGE_KEY+'_'+date,JSON.stringify(data));}
function loadDataForDate(date){try{const raw=localStorage.getItem(STORAGE_KEY+'_'+date);return raw?JSON.parse(raw):[];}catch(e){return[];}}
function persistMeta(){localStorage.setItem(META_KEY,JSON.stringify(meta));}
function loadMeta(){try{const raw=localStorage.getItem(META_KEY);return raw?JSON.parse(raw):defaultMeta;}catch(e){return defaultMeta;}}

function updateCurrentDate(){document.getElementById('current-date').textContent=new Date(currentDate).toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});}
function applyMetaToUI(){document.getElementById('class-name').textContent=meta.class_name;document.getElementById('teacher-name').textContent=meta.teacher_name;document.getElementById('teacher-email').textContent=meta.teacher_email;document.getElementById('teacher-phone').textContent=meta.teacher_phone;}
function showToast(msg){const t=document.createElement('div'); t.className='toast'; t.textContent=msg; document.body.appendChild(t); setTimeout(()=>t.remove(),3000);}

// Teacher modal
function openTeacherModal(){
  const backdrop=document.createElement('div');backdrop.className='modal-backdrop';
  const modal=document.createElement('div');modal.className='modal';
  modal.innerHTML=`
    <h3 class="text-lg font-bold mb-4">Edit Class & Teacher</h3>
    <label>Class Name</label><input id='modal-class' class='form-input mb-2' value='${meta.class_name}' />
    <label>Teacher Name</label><input id='modal-name' class='form-input mb-2' value='${meta.teacher_name}' />
    <label>Email</label><input id='modal-email' class='form-input mb-2' value='${meta.teacher_email}' />
    <label>Phone</label><input id='modal-phone' class='form-input mb-4' value='${meta.teacher_phone}' />
    <div class="flex justify-end gap-2">
      <button id='modal-save' class='btn btn-primary'>Save</button>
      <button id='modal-cancel' class='btn'>Cancel</button>
    </div>`;
  backdrop.appendChild(modal);document.body.appendChild(backdrop);
  document.getElementById('modal-cancel').onclick=()=>backdrop.remove();
  document.getElementById('modal-save').onclick=()=>{
    meta.class_name=document.getElementById('modal-class').value||defaultMeta.class_name;
    meta.teacher_name=document.getElementById('modal-name').value||defaultMeta.teacher_name;
    meta.teacher_email=document.getElementById('modal-email').value||defaultMeta.teacher_email;
    meta.teacher_phone=document.getElementById('modal-phone').value||defaultMeta.teacher_phone;
    persistMeta();applyMetaToUI();backdrop.remove();showToast('Teacher info updated');
  };
}

// Student list
function renderStudentList(){
  const container=document.getElementById('student-list');
  container.innerHTML='';
  if(currentData.length===0){
    container.innerHTML='<div class="empty-state"><h3>No students added yet</h3><p>Add students using the form above</p></div>';
    updateSummary(); return;
  }
  currentData.forEach((s,i)=>{
    const div=document.createElement('div');
    div.className=`student-card ${s.status}`;
    div.innerHTML=`<strong>${s.name}</strong>
      <select onchange="changeStatus(${i}, this.value)" class="form-input">
        <option value="present" ${s.status==='present'?'selected':''}>Present</option>
        <option value="absent" ${s.status==='absent'?'selected':''}>Absent</option>
        <option value="late" ${s.status==='late'?'selected':''}>Late</option>
      </select>`;
    container.appendChild(div);
  });
  updateSummary();
}

function changeStatus(index,status){currentData[index].status=status;persistDataForDate(currentDate,currentData);renderStudentList();}
function updateSummary(){
  const counts={present:0,absent:0,late:0};
  currentData.forEach(s=>counts[s.status]++);
  document.getElementById('present-count').textContent=counts.present;
  document.getElementById('absent-count').textContent=counts.absent;
  document.getElementById('late-count').textContent=counts.late;
  document.getElementById('total-count').textContent=currentData.length;
}

function clearTodayAttendance(){if(confirm('Reset attendance for this date?')){currentData=[];persistDataForDate(currentDate,currentData);renderStudentList();showToast('Attendance cleared');}}
function exportAttendance(){if(currentData.length===0){showToast('No data to export');return;}
  let csv='Name,Status\n';
  currentData.forEach(s=>{csv+=`${s.name},${s.status}\n`;});
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download=`attendance_${currentDate}.csv`; a.click();
  URL.revokeObjectURL(url); showToast('CSV exported');
}

// Add student
document.getElementById('add-student-form').onsubmit = function(e){
  e.preventDefault();
  const name = document.getElementById('student-name-input').value.trim();
  if(!name) return;
  currentData.push({name, status:'absent'});
  persistDataForDate(currentDate, currentData); renderStudentList();
  document.getElementById('student-name-input').value=''; showToast(`${name} added`);
}

// Date picker
const dateInput = document.getElementById('attendance-date');
dateInput.value = currentDate;
dateInput.onchange = function(){ 
  currentDate = this.value;
  currentData = loadDataForDate(currentDate);
  updateCurrentDate();
  renderStudentList();
}

// Duplicate attendance modal
function openDuplicateModal(){
  const backdrop=document.createElement('div');backdrop.className='modal-backdrop';
  const modal=document.createElement('div');modal.className='modal';
  modal.innerHTML=`
    <h3 class="text-lg font-bold mb-4">Duplicate Today's Attendance</h3>
    <label>Select Target Date:</label>
    <input type="date" id="duplicate-date" class="form-input mb-4" />
    <div class="flex justify-end gap-2">
      <button id='duplicate-save' class='btn btn-primary'>Duplicate</button>
      <button id='duplicate-cancel' class='btn'>Cancel</button>
    </div>`;
  backdrop.appendChild(modal);document.body.appendChild(backdrop);
  document.getElementById('duplicate-cancel').onclick=()=>backdrop.remove();
  document.getElementById('duplicate-save').onclick=()=>{
    const targetDate=document.getElementById('duplicate-date').value;
    if(!targetDate){alert('Select a date'); return;}
    persistDataForDate(targetDate, JSON.parse(JSON.stringify(currentData)));
    backdrop.remove();
    showToast(`Attendance duplicated to ${targetDate}`);
  };
}

// Initial setup
updateCurrentDate(); applyMetaToUI(); renderStudentList();
</script>
</body>
</html>
